<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MM2025 Archive - Editable</title>
    <style>
        :root {
            --miku-neon: #00ffcc; --mirai-pink: #ff007a; --mirai-purple: #7000ff;
            --glass: rgba(15, 15, 35, 0.95);
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'PingFang HK', 'Heiti TC', sans-serif; background: #050510; color: white; overflow-x: hidden; }

        /* å°é¢é é¢ */
        #cover-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; transition: transform 0.8s cubic-bezier(0.65, 0, 0.35, 1);
        }
        #cover-page.open { transform: translateY(-100%); }
        .cover-upload-label { position: absolute; top: 20px; left: 20px; font-size: 12px; background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 20px; cursor: pointer; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2); }
        .cover-menu { display: flex; flex-direction: column; gap: 15px; width: 260px; }
        .menu-btn { background: var(--glass); border: 1px solid var(--miku-neon); color: var(--miku-neon); padding: 14px; border-radius: 50px; font-size: 15px; font-weight: bold; cursor: pointer; text-align: center; letter-spacing: 2px; transition: 0.3s; }
        .menu-btn:hover { background: var(--miku-neon); color: #000; box-shadow: 0 0 25px var(--miku-neon); }

        /* å…§å®¹å€åŸŸ */
        .main-content { padding: 20px; padding-bottom: 110px; min-height: 100vh; }
        .back-to-cover { margin-bottom: 20px; cursor: pointer; color: var(--miku-neon); font-size: 14px; display: inline-block; }
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* åˆ†é¡ç¯©é¸ */
        .filter-section { margin-bottom: 15px; }
        .filter-group { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .filter-chip { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 6px 14px; border-radius: 20px; font-size: 12px; cursor: pointer; white-space: nowrap; transition: 0.2s; }
        .filter-chip.active { background: var(--miku-neon); color: black; border-color: var(--miku-neon); }

        .glass-card { background: var(--glass); padding: 20px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; backdrop-filter: blur(12px); }

        label { display: block; font-size: 12px; margin: 12px 0 5px 5px; color: var(--miku-neon); font-weight: bold; }
        input, select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #333; background: rgba(0,0,0,0.3); color: white; box-sizing: border-box; }

        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .item-card { background: rgba(255,255,255,0.03); border-radius: 18px; overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.08); }
        .item-img { width: 100%; height: 160px; object-fit: cover; }
        .item-info { padding: 12px; }
        .item-price-hkd { color: var(--mirai-pink); font-weight: bold; font-size: 16px; margin: 3px 0; }
        .checkbox-arrival { position: absolute; top: 10px; right: 10px; transform: scale(1.5); z-index: 10; cursor: pointer; }

        /* æŒ‰éˆ•çµ„ */
        .card-btns { display: flex; justify-content: space-between; margin-top: 10px; }
        .action-link { font-size: 11px; color: #777; cursor: pointer; text-decoration: underline; }
        .action-link:hover { color: var(--miku-neon); }

        .nav-bar { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 85%; max-width: 380px; background: rgba(10,10,25,0.95); display: flex; justify-content: space-around; padding: 12px; border-radius: 35px; border: 1px solid var(--miku-neon); z-index: 1000; backdrop-filter: blur(20px); }
        .nav-item { border: none; background: none; color: #555; font-size: 22px; cursor: pointer; }
        .nav-item.active { color: var(--miku-neon); }
    </style>
</head>
<body>

    <div id="cover-page">
        <label class="cover-upload-label">ğŸ–¼ï¸ å°å…¥å°é¢ <input type="file" id="cover-upload" hidden accept="image/*"></label>
        <div class="cover-menu">
            <h1 style="text-align: center; font-size: 18px; letter-spacing: 3px; color: var(--miku-neon);">ARCHIVE Pro v8</h1>
            <div class="menu-btn" onclick="openPage('page-gallery')">é€²å…¥è—å“åº«</div>
            <div class="menu-btn" onclick="openPage('page-search')">é—œéµå­—æœç´¢</div>
            <div class="menu-btn" onclick="openPage('page-recent')">è¿‘æœŸæ”¶ç´ / æ–°å¢</div>
            <div class="menu-btn" onclick="openPage('page-pending')">å°‡åˆ°éç¾</div>
        </div>
    </div>

    <div class="main-content">
        <div class="back-to-cover" onclick="closePage()">â—€ è¿”å›å°é¢</div>

        <div id="page-gallery" class="page">
            <div class="filter-section">
                <div class="filter-group" id="filterModes">
                    <div class="filter-chip active" onclick="setFilterMode('all', this)">å…¨éƒ¨</div>
                    <div class="filter-chip" onclick="setFilterMode('role', this)">è§’è‰²</div>
                    <div class="filter-chip" onclick="setFilterMode('type', this)">é¡åˆ¥</div>
                    <div class="filter-chip" onclick="setFilterMode('work', this)">ä½œå“</div>
                </div>
                <div class="filter-group" id="subFilters" style="margin-top:10px;"></div>
            </div>
            <div class="gallery" id="readyList"></div>
        </div>

        <div id="page-search" class="page">
            <input type="text" id="globalSearch" placeholder="ğŸ” æœå°‹..." oninput="renderAll()" class="glass-card" style="width:100%">
            <div class="gallery" id="searchResult"></div>
        </div>

        <div id="page-recent" class="page">
            <div class="glass-card">
                <h3 id="formTitle">ğŸ“¦ æ–°å¢ç´€éŒ„</h3>
                <form id="merchForm">
                    <input type="hidden" id="editIndex" value="-1">
                    <label>ä½œå“åˆ†é¡</label>
                    <input type="text" id="work" list="workData" placeholder="ä¾‹ï¼šä¸–ç•Œè¨ˆç•«">
                    <label>è§’è‰²</label>
                    <input type="text" id="role" list="roleData" placeholder="è§’è‰²">
                    <label>æŸ„åœ–åå­—</label>
                    <input type="text" id="pattern" placeholder="ä¾‹ï¼š2025ä¸»è¦–è¦º">
                    <label>å‘¨é‚Šåç¨±</label>
                    <input type="text" id="name" required placeholder="ä¾‹ï¼šå¾½ç« ">
                    <label>é¡åˆ¥</label>
                    <input type="text" id="type" list="typeData" placeholder="ä¾‹ï¼šå¾½ç« ã€ç«‹ç‰Œ">
                    
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <div>
                            <label>ç‹€æ…‹</label>
                            <select id="status" onchange="document.getElementById('mGroup').style.display=this.value=='éç¾è²¨'?'block':'none'">
                                <option value="ç¾è²¨">ç¾è²¨</option><option value="éç¾è²¨">éç¾è²¨</option>
                            </select>
                        </div>
                        <div id="mGroup" style="display:none"><label>åˆ°è²¨æœˆä»½</label><input type="month" id="month"></div>
                    </div>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <div><label>æ•¸é‡</label><input type="number" id="qty" value="1" min="1" oninput="calcEx()"></div>
                        <div><label>å¹£ç¨®</label><select id="currency" onchange="calcEx()"><option value="HKD">HKD</option><option value="RMB">RMB</option><option value="JPY">JPY</option></select></div>
                    </div>

                    <label>å–®åƒ¹ (åŸå¹£é‡‘é¡)</label>
                    <input type="number" id="inputPrice" placeholder="å–®åƒ¹" required oninput="calcEx()">
                    <div id="resultHkd" style="margin-top:8px; font-weight:bold; color:var(--mirai-pink)">ç¸½é¡: HKD 0</div>

                    <label>ç…§ç‰‡ (ç•™ç©ºå‰‡ä¿ç•™åŸåœ–)</label><input type="file" id="imgFile">
                    <button type="submit" id="submitBtn" class="menu-btn" style="width:100%; margin-top:25px;">ç¢ºèªå­˜æª” âœ¨</button>
                    <button type="button" id="cancelEdit" class="menu-btn" style="width:100%; margin-top:10px; border-color:#555; color:#aaa; display:none;" onclick="resetForm()">å–æ¶ˆç·¨è¼¯</button>
                </form>
            </div>
        </div>

        <div id="page-pending" class="page">
            <h3 style="color:var(--mirai-pink)">âŒ› å¾…æ”¶æ¸…å–®</h3>
            <div class="gallery" id="waitList"></div>
        </div>
    </div>

    <nav class="nav-bar" id="bottom-nav" style="display:none;">
        <button class="nav-item active" onclick="switchTab('page-gallery', this)">ğŸ’</button>
        <button class="nav-item" onclick="switchTab('page-search', this)">ğŸ”</button>
        <button class="nav-item" onclick="switchTab('page-recent', this)">â•</button>
        <button class="nav-item" onclick="switchTab('page-pending', this)">ğŸ“¦</button>
    </nav>

    <datalist id="roleData"><option value="åˆéŸ³æœªä¾†"><option value="æ›‰å±±ç‘å¸Œ"><option value="å®µå´å¥"></datalist>
    <datalist id="typeData"><option value="å¾½ç« "><option value="ç«‹ç‰Œ"><option value="è‰²ç´™"></datalist>
    <datalist id="workData"><option value="ä¸–ç•Œè¨ˆç•«"><option value="VOCALOID"></datalist>

<script>
    let merchList = JSON.parse(localStorage.getItem('mm25_v8_data')) || [];
    const rates = { RMB: 1.08, JPY: 0.052, HKD: 1.0 };
    let currentFilterMode = 'all';
    let currentSubFilter = '';

    function calcEx() {
        const cur = document.getElementById('currency').value;
        const price = document.getElementById('inputPrice').value || 0;
        const qty = document.getElementById('qty').value || 1;
        const singleHkd = (price * rates[cur]).toFixed(2);
        const totalHkd = (singleHkd * qty).toFixed(2);
        document.getElementById('resultHkd').innerText = `ç¸½é¡: HKD ${totalHkd} (å–®åƒ¹: HKD ${singleHkd})`;
        return { singleHkd, totalHkd, originalPrice: price, originalCur: cur };
    }

    const coverPage = document.getElementById('cover-page');
    if(localStorage.getItem('mm25_cover_v8')) coverPage.style.backgroundImage = `url(${localStorage.getItem('mm25_cover_v8')})`;
    document.getElementById('cover-upload').onchange = e => {
        const r = new FileReader();
        r.onload = () => { localStorage.setItem('mm25_cover_v8', r.result); coverPage.style.backgroundImage = `url(${r.result})`; };
        r.readAsDataURL(e.target.files[0]);
    };

    function openPage(id) { 
        document.getElementById('cover-page').classList.add('open');
        document.getElementById('bottom-nav').style.display = 'flex';
        switchTab(id, document.querySelector(`[onclick*="${id}"]`)); 
    }
    function closePage() { document.getElementById('cover-page').classList.remove('open'); document.getElementById('bottom-nav').style.display = 'none'; }

    function switchTab(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(btn) btn.classList.add('active');
        renderAll();
    }

    function setFilterMode(mode, btn) {
        currentFilterMode = mode; currentSubFilter = '';
        document.querySelectorAll('#filterModes .filter-chip').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        const sub = document.getElementById('subFilters');
        if(mode === 'all') sub.innerHTML = '';
        else {
            const keys = [...new Set(merchList.filter(i => i.status === 'ç¾è²¨').map(i => i[mode]))];
            sub.innerHTML = keys.map(k => `<div class="filter-chip" onclick="currentSubFilter='${k}';renderAll();updateSubStyle(this)">${k}</div>`).join('');
        }
        renderAll();
    }
    function updateSubStyle(btn) { document.querySelectorAll('#subFilters .filter-chip').forEach(c => c.classList.remove('active')); btn.classList.add('active'); }

    function renderAll() {
        const q = document.getElementById('globalSearch').value.toLowerCase();
        const genHTML = (item, idx) => `
            <div class="item-card">
                ${item.status==='éç¾è²¨' ? `<input type="checkbox" class="checkbox-arrival" onclick="arrived(${idx})">` : ''}
                <img src="${item.img || 'https://via.placeholder.com/200/0a0a19/00ffcc?text=No+Photo'}" class="item-img">
                <div class="item-info">
                    <div style="color:var(--miku-neon); font-size:10px;">${item.role} | ${item.type}</div>
                    <div style="font-weight:bold; margin:3px 0; font-size:13px; height:36px; overflow:hidden;">${item.pattern} - ${item.name}</div>
                    <div class="item-price-hkd">HK$ ${item.totalHkd}</div>
                    <div style="font-size:10px; opacity:0.6;">æ•¸é‡: ${item.qty} (${item.originalPrice} ${item.originalCur})</div>
                    <div class="card-btns">
                        <span class="action-link" onclick="editItem(${idx})">ç·¨è¼¯è³‡æ–™</span>
                        <span class="action-link" style="color:#ff4d4d" onclick="deleteItem(${idx})">åˆªé™¤</span>
                    </div>
                </div>
            </div>`;

        document.getElementById('readyList').innerHTML = merchList.filter(i => {
            if(i.status !== 'ç¾è²¨') return false;
            if(currentFilterMode !== 'all' && currentSubFilter && i[currentFilterMode] !== currentSubFilter) return false;
            return true;
        }).map(i => genHTML(i, merchList.indexOf(i))).join('');

        document.getElementById('waitList').innerHTML = merchList.filter(i => i.status === 'éç¾è²¨').map(i => genHTML(i, merchList.indexOf(i))).join('');
        document.getElementById('searchResult').innerHTML = merchList.filter(i => (i.name+i.role+i.pattern+i.type).toLowerCase().includes(q)).map(i => genHTML(i, merchList.indexOf(i))).join('');
    }

    function editItem(idx) {
        const item = merchList[idx];
        document.getElementById('editIndex').value = idx;
        document.getElementById('work').value = item.work;
        document.getElementById('role').value = item.role;
        document.getElementById('pattern').value = item.pattern;
        document.getElementById('name').value = item.name;
        document.getElementById('type').value = item.type;
        document.getElementById('status').value = item.status;
        document.getElementById('month').value = item.month || '';
        document.getElementById('qty').value = item.qty;
        document.getElementById('currency').value = item.originalCur;
        document.getElementById('inputPrice').value = item.originalPrice;
        
        document.getElementById('formTitle').innerText = "âœï¸ ç·¨è¼¯ç´€éŒ„";
        document.getElementById('submitBtn').innerText = "æ›´æ–°ç¾æœ‰ç´€éŒ„ âœ¨";
        document.getElementById('cancelEdit').style.display = "block";
        document.getElementById('mGroup').style.display = item.status === 'éç¾è²¨' ? 'block' : 'none';
        
        calcEx();
        switchTab('page-recent', document.querySelector(`[onclick*="page-recent"]`));
    }

    function resetForm() {
        document.getElementById('merchForm').reset();
        document.getElementById('editIndex').value = "-1";
        document.getElementById('formTitle').innerText = "ğŸ“¦ æ–°å¢ç´€éŒ„";
        document.getElementById('submitBtn').innerText = "ç¢ºèªå­˜æª” âœ¨";
        document.getElementById('cancelEdit').style.display = "none";
        document.getElementById('resultHkd').innerText = "ç¸½é¡: HKD 0";
    }

    function arrived(idx) { merchList[idx].status = 'ç¾è²¨'; save(); renderAll(); }
    function deleteItem(idx) { if(confirm('åˆªé™¤ï¼Ÿ')) { merchList.splice(idx,1); save(); renderAll(); } }
    function save() { localStorage.setItem('mm25_v8_data', JSON.stringify(merchList)); }

    document.getElementById('merchForm').onsubmit = function(e) {
        e.preventDefault();
        const ex = calcEx();
        const editIdx = parseInt(document.getElementById('editIndex').value);
        const file = document.getElementById('imgFile').files[0];
        
        const doSave = (b64) => {
            const data = {
                work: document.getElementById('work').value || 'æœªåˆ†é¡',
                role: document.getElementById('role').value || 'æœªå®š',
                pattern: document.getElementById('pattern').value || 'æœªçŸ¥æŸ„åœ–',
                name: document.getElementById('name').value,
                type: document.getElementById('type').value || 'å…¶ä»–',
                status: document.getElementById('status').value,
                month: document.getElementById('month').value,
                qty: document.getElementById('qty').value,
                singleHkd: ex.singleHkd,
                totalHkd: ex.totalHkd,
                originalPrice: ex.originalPrice,
                originalCur: ex.originalCur,
                img: b64 || (editIdx !== -1 ? merchList[editIdx].img : null)
            };

            if(editIdx === -1) merchList.unshift(data);
            else merchList[editIdx] = data;

            save(); resetForm(); alert('å­˜æª”æˆåŠŸï¼'); renderAll();
            switchTab('page-gallery', document.querySelector(`[onclick*="page-gallery"]`));
        };

        if(file) { const r = new FileReader(); r.onload = () => doSave(r.result); r.readAsDataURL(file); }
        else doSave(null);
    };

    renderAll();
</script>
</body>
</html>
