<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magical Mirai 2025 Collection</title>
    <style>
        :root {
            --miku-neon: #00ffcc;
            --mirai-pink: #ff007a;
            --mirai-purple: #7000ff;
            --glass: rgba(10, 10, 25, 0.8);
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'PingFang TC', sans-serif; background: #050510; color: white; overflow-x: hidden; }

        /* --- å°é¢é é¢ --- */
        #cover-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; transition: transform 0.8s cubic-bezier(0.65, 0, 0.35, 1);
        }
        
        #cover-page.open { transform: translateY(-100%); }

        .cover-upload-label {
            position: absolute; top: 20px; left: 20px; font-size: 12px;
            background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 20px;
            cursor: pointer; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2);
        }

        .cover-menu { display: flex; flex-direction: column; gap: 20px; width: 250px; }
        .menu-btn {
            background: var(--glass); border: 1px solid var(--miku-neon);
            color: var(--miku-neon); padding: 15px; border-radius: 50px;
            font-size: 16px; font-weight: bold; cursor: pointer; text-align: center;
            text-transform: uppercase; letter-spacing: 2px; transition: 0.3s;
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.2);
        }
        .menu-btn:hover { background: var(--miku-neon); color: #000; box-shadow: 0 0 30px var(--miku-neon); }

        /* --- å…§å®¹å€åŸŸ --- */
        .main-content { padding: 20px; padding-bottom: 100px; min-height: 100vh; }
        .back-to-cover { margin-bottom: 20px; cursor: pointer; color: var(--miku-neon); font-size: 14px; }

        .page { display: none; animation: fadeIn 0.5s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* å¡ç‰‡èˆ‡è¡¨å–® */
        .glass-card {
            background: var(--glass); padding: 20px; border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .item-card { 
            background: rgba(255,255,255,0.05); border-radius: 15px; overflow: hidden; 
            position: relative; border: 1px solid rgba(255,255,255,0.1);
        }
        .item-img { width: 100%; height: 160px; object-fit: cover; }
        .item-info { padding: 10px; font-size: 13px; }
        .item-price { color: var(--mirai-pink); font-weight: bold; font-size: 16px; }

        .checkbox-arrival { position: absolute; top: 10px; right: 10px; transform: scale(1.5); cursor: pointer; }

        input, select, textarea { 
            width: 100%; padding: 12px; margin-top: 8px; border-radius: 10px; 
            border: 1px solid #333; background: #1a1a2e; color: white; 
        }

        /* åº•éƒ¨å°èˆª (éš±è—ï¼Œåªåœ¨å…§é é¡¯ç¤º) */
        .nav-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 85%; max-width: 400px; background: var(--glass);
            display: flex; justify-content: space-around; padding: 12px;
            border-radius: 30px; border: 1px solid var(--miku-neon); z-index: 1000;
        }
        .nav-item { border: none; background: none; color: #666; font-size: 20px; cursor: pointer; }
        .nav-item.active { color: var(--miku-neon); }
    </style>
</head>
<body>

    <div id="cover-page">
        <label class="cover-upload-label">
            ğŸ–¼ï¸ å°å…¥å°é¢ç…§ç‰‡ <input type="file" id="cover-upload" hidden accept="image/*">
        </label>
        
        <div class="cover-menu">
            <h1 style="text-align: center; font-size: 20px; letter-spacing: 4px; color: var(--miku-neon); margin-bottom: 30px;">MAGICAL MIRAI 2025</h1>
            <div class="menu-btn" onclick="openDatabase('page-gallery')">é€²å…¥è—å“åº«</div>
            <div class="menu-btn" onclick="openDatabase('page-search')">é—œéµå­—æœç´¢</div>
            <div class="menu-btn" onclick="openDatabase('page-recent')">è¿‘æœŸæ”¶ç´</div>
            <div class="menu-btn" onclick="openDatabase('page-pending')">å°‡åˆ°éç¾</div>
        </div>
    </div>

    <div class="main-content" id="main-ui">
        <div class="back-to-cover" onclick="closeDatabase()">â—€ è¿”å›å°é¢</div>

        <div id="page-gallery" class="page">
            <div class="gallery" id="readyList"></div>
        </div>

        <div id="page-search" class="page">
            <input type="text" id="globalSearch" placeholder="ğŸ” è¼¸å…¥è§’è‰²ã€åç¨±æˆ–å‚™è¨»æœå°‹..." oninput="renderAll()" class="glass-card">
            <div class="gallery" id="searchResult"></div>
        </div>

        <div id="page-recent" class="page">
            <div class="glass-card">
                <h3>âœ¨ æ–°å¢è—å“</h3>
                <form id="merchForm">
                    <label>ä½œå“åˆ†é¡</label>
                    <select id="work"><option>ä¸–ç•Œè¨ˆç•«</option><option>VOCALOID</option></select>
                    <label>è§’è‰²</label><input type="text" id="role" list="roleData" placeholder="è‡ªå¡«æˆ–é¸å–">
                    <label>å‘¨é‚Šåç¨±</label><input type="text" id="name" required>
                    <label>ç‹€æ…‹</label>
                    <select id="status" onchange="document.getElementById('mGroup').style.display=this.value=='éç¾è²¨'?'block':'none'">
                        <option value="ç¾è²¨">ç¾è²¨</option><option value="éç¾è²¨">éç¾è²¨</option>
                    </select>
                    <div id="mGroup" style="display:none"><label>åˆ°è²¨æœˆä»½</label><input type="month" id="month"></div>
                    <label>åƒ¹æ ¼</label><input type="number" id="price" required>
                    <label>ä¾†æº</label><input type="text" id="source" list="sourceData">
                    <label>ç…§ç‰‡</label><input type="file" id="imgFile">
                    <button type="submit" class="menu-btn" style="width:100%; margin-top:20px;">å­˜å…¥æª”æ¡ˆ</button>
                </form>
            </div>
        </div>

        <div id="page-pending" class="page">
            <h3 style="color:var(--mirai-pink)">ğŸ›’ é è³¼å¾…æ”¶ (å‹¾é¸æ–¹æ ¼æ¨™è¨»åˆ°è²¨)</h3>
            <div class="gallery" id="waitList"></div>
        </div>
    </div>

    <nav class="nav-bar" id="bottom-nav" style="display:none;">
        <button class="nav-item active" onclick="switchTab('page-gallery', this)">ğŸ–¼ï¸</button>
        <button class="nav-item" onclick="switchTab('page-search', this)">ğŸ”</button>
        <button class="nav-item" onclick="switchTab('page-recent', this)">â•</button>
        <button class="nav-item" onclick="switchTab('page-pending', this)">ğŸ“¦</button>
    </nav>

    <datalist id="roleData"><option value="åˆéŸ³æœªä¾†"><option value="æ›‰å±±ç‘å¸Œ"><option value="å®µå´å¥"></datalist>
    <datalist id="sourceData"><option value="Mercari"><option value="å®‰åˆ©ç¾ç‰¹"></datalist>

<script>
    let merchList = JSON.parse(localStorage.getItem('mm2025_data')) || [];
    
    // å°é¢ç…§ç‰‡é‚è¼¯
    const coverUpload = document.getElementById('cover-upload');
    const coverPage = document.getElementById('cover-page');
    
    // è®€å–å­˜å¥½çš„å°é¢
    if(localStorage.getItem('mm2025_cover')) {
        coverPage.style.backgroundImage = `url(${localStorage.getItem('mm2025_cover')})`;
    }

    coverUpload.onchange = e => {
        const reader = new FileReader();
        reader.onload = () => {
            const b64 = reader.result;
            coverPage.style.backgroundImage = `url(${b64})`;
            localStorage.setItem('mm2025_cover', b64);
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    // åˆ‡æ›é‚è¼¯
    function openDatabase(targetPage) {
        document.getElementById('cover-page').classList.add('open');
        document.getElementById('bottom-nav').style.display = 'flex';
        switchTab(targetPage, document.querySelector(`[onclick*="${targetPage}"]`));
    }

    function closeDatabase() {
        document.getElementById('cover-page').classList.remove('open');
        document.getElementById('bottom-nav').style.display = 'none';
    }

    function switchTab(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        btn.classList.add('active');
        renderAll();
    }

    function renderAll() {
        const query = document.getElementById('globalSearch').value.toLowerCase();
        const containers = {
            'readyList': merchList.filter(i => i.status === 'ç¾è²¨'),
            'waitList': merchList.filter(i => i.status === 'éç¾è²¨'),
            'searchResult': merchList.filter(i => i.name.toLowerCase().includes(query) || i.role.toLowerCase().includes(query))
        };

        Object.keys(containers).forEach(id => {
            const el = document.getElementById(id);
            if(!el) return;
            el.innerHTML = containers[id].map((item, idx) => `
                <div class="item-card">
                    ${item.status==='éç¾è²¨' ? `<input type="checkbox" class="checkbox-arrival" onclick="toReady(${idx})">` : ''}
                    <img src="${item.img || 'https://via.placeholder.com/200/0a0a19/00ffcc?text=MIRAI'}" class="item-img">
                    <div class="item-info">
                        <div style="color:var(--miku-neon); font-size:10px;">${item.role}</div>
                        <div style="font-weight:bold; margin:3px 0;">${item.name}</div>
                        <div class="item-price">$${Number(item.price).toLocaleString()}</div>
                        ${item.month ? `<div style="font-size:10px; opacity:0.6;">åˆ°è²¨: ${item.month}</div>` : ''}
                    </div>
                </div>
            `).join('');
        });
    }

    function toReady(idx) {
        merchList[idx].status = 'ç¾è²¨';
        localStorage.setItem('mm2025_data', JSON.stringify(merchList));
        renderAll();
    }

    document.getElementById('merchForm').onsubmit = function(e) {
        e.preventDefault();
        const file = document.getElementById('imgFile').files[0];
        const save = (b64) => {
            merchList.unshift({
                role: document.getElementById('role').value || 'æœªå®šç¾©',
                name: document.getElementById('name').value,
                status: document.getElementById('status').value,
                month: document.getElementById('month').value,
                price: document.getElementById('price').value,
                img: b64
            });
            localStorage.setItem('mm2025_data', JSON.stringify(merchList));
            this.reset(); alert('æˆåŠŸå­˜å…¥å…¸è—é›† âœ¨'); renderAll();
        };
        if(file) { const r = new FileReader(); r.onload = () => save(r.result); r.readAsDataURL(file); }
        else save(null);
    };

    renderAll();
</script>
</body>
</html>
