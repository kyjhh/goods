<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magical Mirai 2025 HK Edition</title>
    <style>
        :root {
            --miku-neon: #00ffcc;
            --mirai-pink: #ff007a;
            --mirai-purple: #7000ff;
            --glass: rgba(15, 15, 35, 0.85);
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'PingFang HK', 'Heiti TC', sans-serif; background: #050510; color: white; overflow-x: hidden; }

        /* --- å°é¢é é¢ --- */
        #cover-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; transition: transform 0.8s cubic-bezier(0.65, 0, 0.35, 1);
        }
        #cover-page.open { transform: translateY(-100%); }

        .cover-upload-label {
            position: absolute; top: 20px; left: 20px; font-size: 12px;
            background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 20px;
            cursor: pointer; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2);
        }

        .cover-menu { display: flex; flex-direction: column; gap: 15px; width: 260px; }
        .menu-btn {
            background: var(--glass); border: 1px solid var(--miku-neon);
            color: var(--miku-neon); padding: 14px; border-radius: 50px;
            font-size: 15px; font-weight: bold; cursor: pointer; text-align: center;
            letter-spacing: 2px; transition: 0.3s;
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.2);
        }
        .menu-btn:hover { background: var(--miku-neon); color: #000; box-shadow: 0 0 25px var(--miku-neon); }

        /* --- å…§å®¹å€åŸŸ --- */
        .main-content { padding: 20px; padding-bottom: 110px; min-height: 100vh; }
        .back-to-cover { margin-bottom: 20px; cursor: pointer; color: var(--miku-neon); font-size: 14px; display: inline-block; }

        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        .glass-card {
            background: var(--glass); padding: 22px; border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;
            backdrop-filter: blur(12px); box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        /* è¡¨å–®æ¨£å¼ */
        label { display: block; font-size: 12px; margin: 12px 0 5px 5px; color: var(--miku-neon); font-weight: bold; }
        input, select, textarea { 
            width: 100%; padding: 12px; border-radius: 12px; 
            border: 1px solid #333; background: rgba(0,0,0,0.3); color: white; box-sizing: border-box;
        }

        .exchange-info { font-size: 11px; color: #888; margin-top: 5px; }

        /* ç•«å»Š */
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .item-card { 
            background: rgba(255,255,255,0.03); border-radius: 18px; overflow: hidden; 
            position: relative; border: 1px solid rgba(255,255,255,0.08); transition: 0.3s;
        }
        .item-img { width: 100%; height: 160px; object-fit: cover; background: #111; }
        .item-info { padding: 12px; }
        .item-price-hkd { color: var(--mirai-pink); font-weight: bold; font-size: 16px; margin: 5px 0; }
        .original-price { font-size: 10px; color: #777; }

        .checkbox-arrival { position: absolute; top: 12px; right: 12px; transform: scale(1.6); cursor: pointer; z-index: 5; }

        /* å°èˆª */
        .nav-bar {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 85%; max-width: 380px; background: rgba(10,10,25,0.9);
            display: flex; justify-content: space-around; padding: 12px;
            border-radius: 35px; border: 1px solid var(--miku-neon); z-index: 1000;
            backdrop-filter: blur(20px);
        }
        .nav-item { border: none; background: none; color: #555; font-size: 22px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--miku-neon); transform: scale(1.2); }
    </style>
</head>
<body>

    <div id="cover-page">
        <label class="cover-upload-label">ğŸ–¼ï¸ å°å…¥æ›¸æœ¬å°é¢ <input type="file" id="cover-upload" hidden accept="image/*"></label>
        <div class="cover-menu">
            <h1 style="text-align: center; font-size: 18px; letter-spacing: 3px; color: var(--miku-neon); margin-bottom: 20px;">SEKAI ARCHIVE 2025</h1>
            <div class="menu-btn" onclick="openPage('page-gallery')">é€²å…¥è—å“åº«</div>
            <div class="menu-btn" onclick="openPage('page-search')">é—œéµå­—æœç´¢</div>
            <div class="menu-btn" onclick="openPage('page-recent')">è¿‘æœŸæ”¶ç´</div>
            <div class="menu-btn" onclick="openPage('page-pending')">å°‡åˆ°éç¾</div>
        </div>
    </div>

    <div class="main-content">
        <div class="back-to-cover" onclick="closePage()">â—€ è¿”å›æ›¸æœ¬å°é¢</div>

        <div id="page-gallery" class="page">
            <h3 style="color:var(--miku-neon)">âœ¨ æˆ‘çš„æ”¶è—ç¾è²¨</h3>
            <div class="gallery" id="readyList"></div>
        </div>

        <div id="page-search" class="page">
            <input type="text" id="globalSearch" placeholder="ğŸ” æœå°‹è§’è‰²ã€å‘¨é‚Šæˆ–å‚™è¨»..." oninput="renderAll()" class="glass-card">
            <div class="gallery" id="searchResult"></div>
        </div>

        <div id="page-recent" class="page">
            <div class="glass-card">
                <h3>ğŸ“¦ æ–°å¢ç´€éŒ„</h3>
                <form id="merchForm">
                    <label>è§’è‰²</label><input type="text" id="role" list="roleData" placeholder="è¼¸å…¥æˆ–é¸å–è§’è‰²">
                    <label>å‘¨é‚Šåç¨±</label><input type="text" id="name" required>
                    <label>é¡åˆ¥ (å¯è‡ªå¡«)</label><input type="text" id="type" list="typeData" placeholder="ä¾‹å¦‚ï¼šé–ƒå¾½ã€è‰²ç´™">
                    
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <div>
                            <label>ç‹€æ…‹</label>
                            <select id="status" onchange="document.getElementById('mGroup').style.display=this.value=='éç¾è²¨'?'block':'none'">
                                <option value="ç¾è²¨">ç¾è²¨</option><option value="éç¾è²¨">éç¾è²¨</option>
                            </select>
                        </div>
                        <div id="mGroup" style="display:none">
                            <label>åˆ°è²¨æœˆä»½</label><input type="month" id="month">
                        </div>
                    </div>

                    <label>è¼¸å…¥åƒ¹æ ¼</label>
                    <div style="display:grid; grid-template-columns: 80px 1fr; gap:10px;">
                        <select id="currency" onchange="calcEx()">
                            <option value="HKD">HKD</option>
                            <option value="RMB">RMB</option>
                            <option value="JPY">JPY</option>
                        </select>
                        <input type="number" id="inputPrice" placeholder="é‡‘é¡" required oninput="calcEx()">
                    </div>
                    <div class="exchange-info" id="exInfo">åŒ¯ç‡åƒè€ƒ: 1 RMB = 1.08 HKD | 1 JPY = 0.052 HKD</div>
                    <div id="resultHkd" style="margin-top:5px; font-weight:bold; color:var(--mirai-pink)">æ›ç®—çµæœ: HKD 0</div>

                    <label>è³¼è²·ä¾†æº</label><input type="text" id="source" list="sourceData">
                    <label>ä¸Šå‚³ç…§ç‰‡</label><input type="file" id="imgFile">
                    <button type="submit" class="menu-btn" style="width:100%; margin-top:25px;">ç¢ºèªå­˜æª” âœ¨</button>
                </form>
            </div>
        </div>

        <div id="page-pending" class="page">
            <h3 style="color:var(--mirai-pink)">âŒ› é è³¼/ä»£è³¼å¾…æ”¶</h3>
            <div class="gallery" id="waitList"></div>
        </div>
    </div>

    <nav class="nav-bar" id="bottom-nav" style="display:none;">
        <button class="nav-item active" onclick="switchTab('page-gallery', this)">ğŸ’</button>
        <button class="nav-item" onclick="switchTab('page-search', this)">ğŸ”</button>
        <button class="nav-item" onclick="switchTab('page-recent', this)">â•</button>
        <button class="nav-item" onclick="switchTab('page-pending', this)">ğŸ“¦</button>
    </nav>

    <datalist id="roleData"><option value="åˆéŸ³æœªä¾†"><option value="æ›‰å±±ç‘å¸Œ"><option value="å®µå´å¥"><option value="æ±é›²ç¹ªå"></datalist>
    <datalist id="typeData"><option value="è¥Ÿç«  (å¾½ç« )"><option value="è‰²ç´™"><option value="ç«‹ç‰Œ"><option value="æ‹ç«‹å¾—/Pera-pachi"><option value="å…¬ä»”/è¶´è¶´"></datalist>
    <datalist id="sourceData"><option value="Mercari"><option value="å®‰åˆ©ç¾ç‰¹"><option value="æ·˜å¯¶/é–‘é­š"><option value="Facebookç¤¾åœ˜"></datalist>

<script>
    let merchList = JSON.parse(localStorage.getItem('mm25_hk_data')) || [];
    
    // ç›®å‰åŒ¯ç‡è¨­å®š
    const rates = { RMB: 1.08, JPY: 0.052, HKD: 1.0 };

    // åŒ¯ç‡è¨ˆç®—
    function calcEx() {
        const cur = document.getElementById('currency').value;
        const price = document.getElementById('inputPrice').value || 0;
        const result = (price * rates[cur]).toFixed(2);
        document.getElementById('resultHkd').innerText = `æ›ç®—çµæœ: HKD ${result}`;
        return { hkd: result, original: `${price} ${cur}` };
    }

    // å°é¢é‚è¼¯
    const coverPage = document.getElementById('cover-page');
    if(localStorage.getItem('mm25_hk_cover')) coverPage.style.backgroundImage = `url(${localStorage.getItem('mm25_hk_cover')})`;
    
    document.getElementById('cover-upload').onchange = e => {
        const r = new FileReader();
        r.onload = () => { localStorage.setItem('mm25_hk_cover', r.result); coverPage.style.backgroundImage = `url(${r.result})`; };
        r.readAsDataURL(e.target.files[0]);
    };

    function openPage(id) {
        document.getElementById('cover-page').classList.add('open');
        document.getElementById('bottom-nav').style.display = 'flex';
        switchTab(id, document.querySelector(`[onclick*="${id}"]`));
    }

    function closePage() {
        document.getElementById('cover-page').classList.remove('open');
        document.getElementById('bottom-nav').style.display = 'none';
    }

    function switchTab(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(btn) btn.classList.add('active');
        renderAll();
    }

    function renderAll() {
        const q = document.getElementById('globalSearch').value.toLowerCase();
        const containers = {
            'readyList': merchList.filter(i => i.status === 'ç¾è²¨'),
            'waitList': merchList.filter(i => i.status === 'éç¾è²¨'),
            'searchResult': merchList.filter(i => i.name.toLowerCase().includes(q) || i.role.toLowerCase().includes(q) || i.type.toLowerCase().includes(q))
        };

        Object.keys(containers).forEach(id => {
            const el = document.getElementById(id);
            if(!el) return;
            el.innerHTML = containers[id].map((item, idx) => `
                <div class="item-card">
                    ${item.status==='éç¾è²¨' ? `<input type="checkbox" class="checkbox-arrival" onclick="arrived(${idx})">` : ''}
                    <img src="${item.img || 'https://via.placeholder.com/200/0a0a19/00ffcc?text=MM2025'}" class="item-img">
                    <div class="item-info">
                        <div style="color:var(--miku-neon); font-size:10px;">${item.role} | ${item.type}</div>
                        <div style="font-weight:bold; margin:3px 0; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${item.name}</div>
                        <div class="item-price-hkd">HK$ ${Number(item.hkd).toLocaleString()}</div>
                        <div class="original-price">åŸåƒ¹: ${item.original}</div>
                        <div style="font-size:9px; color:#555; margin-top:5px;" onclick="deleteItem(${idx})">ç§»é™¤ç´€éŒ„ [âœ•]</div>
                    </div>
                </div>
            `).join('');
        });
    }

    function arrived(idx) {
        merchList[idx].status = 'ç¾è²¨';
        localStorage.setItem('mm25_hk_data', JSON.stringify(merchList));
        renderAll();
    }

    function deleteItem(idx) {
        if(confirm('ç¢ºå®šç§»é™¤æ­¤ç´€éŒ„ï¼Ÿ')) { merchList.splice(idx, 1); localStorage.setItem('mm25_hk_data', JSON.stringify(merchList)); renderAll(); }
    }

    document.getElementById('merchForm').onsubmit = function(e) {
        e.preventDefault();
        const ex = calcEx();
        const file = document.getElementById('imgFile').files[0];
        const save = (b64) => {
            merchList.unshift({
                role: document.getElementById('role').value || 'æœªçŸ¥è§’è‰²',
                name: document.getElementById('name').value,
                type: document.getElementById('type').value || 'æœªåˆ†é¡',
                status: document.getElementById('status').value,
                month: document.getElementById('month').value,
                hkd: ex.hkd,
                original: ex.original,
                img: b64
            });
            localStorage.setItem('mm25_hk_data', JSON.stringify(merchList));
            this.reset(); document.getElementById('resultHkd').innerText = "æ›ç®—çµæœ: HKD 0"; alert('æˆåŠŸè¨˜éŒ„å…¥åº«ï¼âœ¨'); renderAll();
        };
        if(file) { const r = new FileReader(); r.onload = () => save(r.result); r.readAsDataURL(file); }
        else save(null);
    };

    renderAll();
</script>
</body>
</html>
