<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å‘¨é‚Šæ”¶è—ç¸½åº«</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #6c5ce7; --bg: #f8f9fa; --card: #ffffff; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* å°èˆªèˆ‡æœç´¢ */
        .header-tools { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; align-items: center; }
        .search-bar { flex-grow: 1; padding: 12px; border-radius: 8px; border: 1px solid #ddd; }
        
        /* è¡¨å–®å€åŸŸ */
        .form-card { background: var(--card); padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .grid-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        label { display: block; font-size: 13px; color: #666; margin-bottom: 5px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        
        /* ç´€éŒ„çµ±è¨ˆ */
        .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: var(--primary); color: white; padding: 20px; border-radius: 15px; text-align: center; }

        /* æ”¶è—åˆ—è¡¨ (ç•«å»Šé¢¨æ ¼) */
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .item-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; }
        .item-img { width: 100%; height: 200px; object-fit: cover; background: #eee; }
        .item-content { padding: 15px; }
        .tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-right: 5px; background: #eee; color: #555; }
        .price { font-size: 18px; color: #e74c3c; font-weight: bold; margin: 10px 0; }
        .link-btn { display: inline-block; margin-top: 10px; font-size: 12px; color: var(--primary); text-decoration: none; border: 1px solid var(--primary); padding: 2px 8px; border-radius: 4px; }
        .del-btn { position: absolute; top: 10px; right: 10px; background: rgba(231, 76, 60, 0.8); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¨ å‘¨é‚Šç´€éŒ„æ”¶è—ç³»çµ±</h1>

    <div class="stats-row">
        <div class="stat-box">
            <h3>ç¸½è³¼è²·ç´€éŒ„</h3>
            <div style="font-size: 30px;" id="countDisplay">0 ä»½</div>
        </div>
        <div class="stat-box" style="background: #00b894;">
            <h3>ç¸½èŠ±è²»é‡‘é¡</h3>
            <div style="font-size: 30px;">NT$ <span id="totalDisplay">0</span></div>
        </div>
    </div>

    <div class="header-tools">
        <input type="text" id="searchInput" class="search-bar" placeholder="ğŸ” æœå°‹ä½œå“ã€å‘¨é‚Šåç¨±æˆ–å‚™è¨»..." oninput="renderGallery()">
        <select id="filterWork" onchange="renderGallery()" style="width: auto;">
            <option value="">æ‰€æœ‰ä½œå“åˆ†é¡</option>
        </select>
    </div>

    <div class="form-card">
        <h3>â• æ–°å¢è³¼è²·ç´€éŒ„</h3>
        <form id="merchForm">
            <div class="grid-form">
                <div>
                    <label>ä½œå“åç¨±</label>
                    <input type="text" id="workName" placeholder="ä¾‹å¦‚ï¼šæ’çƒå°‘å¹´" required list="workList">
                    <datalist id="workList"></datalist>
                </div>
                <div>
                    <label>å‘¨é‚Šåç¨±</label>
                    <input type="text" id="itemName" placeholder="ä¾‹å¦‚ï¼šå½±å±±é£›é›„ 2024 ç”Ÿæ—¥å¾½ç« " required>
                </div>
                <div>
                    <label>å‘¨é‚Šé¡åˆ¥</label>
                    <select id="itemType">
                        <option value="è¥Ÿç« /å¾½ç« ">è¥Ÿç« /å¾½ç« </option>
                        <option value="è‰²ç´™">è‰²ç´™</option>
                        <option value="æ›ä»¶/åŠé£¾">æ›ä»¶/åŠé£¾</option>
                        <option value="ç«‹ç‰Œ">ç«‹ç‰Œ</option>
                        <option value="å…¬ä»”/é»åœŸäºº">å…¬ä»”/é»åœŸäºº</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                <div>
                    <label>åƒ¹éŒ¢ (NTD)</label>
                    <input type="number" id="price" required>
                </div>
                <div>
                    <label>è³¼è²·ä¾†æº</label>
                    <input type="text" id="source" placeholder="ä¾‹å¦‚ï¼šå®‰åˆ©ç¾ç‰¹ã€ç¤¾åœ˜æ¨æ–‡">
                </div>
                <div>
                    <label>è³¼è²·æ™‚é–“</label>
                    <input type="date" id="buyDate">
                </div>
            </div>
            
            <div style="margin-top: 15px;">
                <label>è³¼è²·ç¶²å€</label>
                <input type="url" id="buyUrl" placeholder="https://...">
            </div>

            <div style="margin-top: 15px;">
                <label>ä¸Šå‚³ç…§ç‰‡</label>
                <input type="file" id="imageFile" accept="image/*">
            </div>

            <div style="margin-top: 15px;">
                <label>å‚™è¨»</label>
                <textarea id="note" rows="2" placeholder="è©³ç´°è¦æ ¼ã€é è¨ˆåˆ°è²¨æ™‚é–“ç­‰..."></textarea>
            </div>

            <button type="submit" style="background: var(--primary); color: white; padding: 12px; border: none; border-radius: 8px; width: 100%; margin-top: 20px; font-size: 16px; cursor: pointer;">ç¢ºèªåŠ å…¥è³¼è²·ç´€éŒ„</button>
        </form>
    </div>

    <div class="gallery" id="merchGallery"></div>
</div>

<script>
    let merchList = JSON.parse(localStorage.getItem('merch_v3_data')) || [];

    // åˆå§‹åŒ–èˆ‡æ¸²æŸ“
    function init() {
        renderGallery();
        updateWorkList();
    }

    function updateWorkList() {
        const works = [...new Set(merchList.map(item => item.work))];
        const datalist = document.getElementById('workList');
        const filter = document.getElementById('filterWork');
        
        datalist.innerHTML = works.map(w => `<option value="${w}">`).join('');
        const currentFilter = filter.value;
        filter.innerHTML = '<option value="">æ‰€æœ‰ä½œå“åˆ†é¡</option>' + 
            works.map(w => `<option value="${w}" ${w===currentFilter?'selected':''}>${w}</option>`).join('');
    }

    function renderGallery() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const workFilter = document.getElementById('filterWork').value;
        const gallery = document.getElementById('merchGallery');
        gallery.innerHTML = '';

        let total = 0;
        let count = 0;

        const filtered = merchList.filter(item => {
            const matchSearch = item.name.toLowerCase().includes(searchTerm) || 
                               item.work.toLowerCase().includes(searchTerm) || 
                               item.note.toLowerCase().includes(searchTerm);
            const matchWork = workFilter === "" || item.work === workFilter;
            return matchSearch && matchWork;
        });

        filtered.forEach((item, index) => {
            total += Number(item.price);
            count++;
            const card = document.createElement('div');
            card.className = 'item-card';
            card.innerHTML = `
                <img src="${item.img || 'https://via.placeholder.com/300x200?text=No+Image'}" class="item-img">
                <button class="del-btn" onclick="deleteItem(${index})">åˆªé™¤</button>
                <div class="item-content">
                    <div><span class="tag" style="background:#ffeaa7">${item.work}</span><span class="tag">${item.type}</span></div>
                    <h3 style="margin:10px 0 5px 0">${item.name}</h3>
                    <div class="price">NT$ ${Number(item.price).toLocaleString()}</div>
                    <div style="font-size:12px; color:#666;">
                        ğŸ“ ä¾†æºï¼š${item.source || 'æœªè¨»è¨˜'}<br>
                        ğŸ“… æ™‚é–“ï¼š${item.date || 'æœªè¨»è¨˜'}<br>
                        ğŸ“ å‚™è¨»ï¼š${item.note || 'ç„¡'}
                    </div>
                    ${item.url ? `<a href="${item.url}" target="_blank" class="link-btn">ğŸ”— æŸ¥çœ‹è³¼è²·é€£çµ</a>` : ''}
                </div>
            `;
            gallery.appendChild(card);
        });

        document.getElementById('totalDisplay').innerText = total.toLocaleString();
        document.getElementById('countDisplay').innerText = count + ' ä»½';
    }

    document.getElementById('merchForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const file = document.getElementById('imageFile').files[0];
        
        const processSave = (imgBase64) => {
            const newItem = {
                work: document.getElementById('workName').value,
                name: document.getElementById('itemName').value,
                type: document.getElementById('itemType').value,
                price: document.getElementById('price').value,
                source: document.getElementById('source').value,
                date: document.getElementById('buyDate').value,
                url: document.getElementById('buyUrl').value,
                note: document.getElementById('note').value,
                img: imgBase64
            };
            merchList.unshift(newItem); // æœ€æ–°è²·çš„æ”¾åœ¨æœ€å‰é¢
            localStorage.setItem('merch_v3_data', JSON.stringify(merchList));
            this.reset();
            updateWorkList();
            renderGallery();
        };

        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => processSave(reader.result);
            reader.readAsDataURL(file);
        } else {
            processSave(null);
        }
    });

    function deleteItem(index) {
        if(confirm('ç¢ºå®šè¦ç§»é™¤é€™ç­†è³¼è²·ç´€éŒ„å—ï¼Ÿ')) {
            merchList.splice(index, 1);
            localStorage.setItem('merch_v3_data', JSON.stringify(merchList));
            updateWorkList();
            renderGallery();
        }
    }

    init();
</script>
</body>
</html>
