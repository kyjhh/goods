<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PJSK å‘¨é‚Šæ”¶è—åº« Pro</title>
    <style>
        :root { 
            --miku-green: #00C2B3; 
            --sekai-purple: #6c5ce7; 
            --bg: #f8f9fa; 
            --nav-bg: #ffffff;
        }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; padding: 15px; }

        /* åˆ†é åˆ‡æ›é‚è¼¯ */
        .page { display: none; }
        .page.active { display: block; }

        /* é ‚éƒ¨æ¨™é¡Œ */
        header { background: linear-gradient(135deg, var(--miku-green), var(--sekai-purple)); padding: 20px; border-radius: 0 0 20px 20px; color: white; text-align: center; margin-bottom: 20px; }

        /* å¡ç‰‡è¨­è¨ˆ */
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .stat-val { font-size: 28px; font-weight: bold; color: var(--sekai-purple); margin: 10px 0; }

        /* è¡¨å–®æ¨£å¼ */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { display: block; font-size: 12px; font-weight: bold; margin: 10px 0 5px; color: #666; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 10px; box-sizing: border-box; background: #fdfdfd; font-size: 14px; }
        .btn-add { background: var(--miku-green); color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; margin-top: 20px; font-weight: bold; font-size: 16px; cursor: pointer; }

        /* ç•«å»Šæ¨£å¼ */
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .item-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; }
        .item-img { width: 100%; height: 160px; object-fit: cover; background: #eee; }
        .item-info { padding: 10px; }
        .item-info h4 { margin: 5px 0; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .price { color: #ff4757; font-weight: bold; font-size: 14px; }
        .status-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; color: white; position: absolute; top: 8px; left: 8px; }
        .bg-ready { background: #2ecc71; } /* ç¾è²¨ */
        .bg-wait { background: #f39c12; }  /* éç¾è²¨ */

        /* åº•éƒ¨å°èˆªåˆ— */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: var(--nav-bg); display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; }
        .nav-item { border: none; background: none; color: #999; font-size: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--sekai-purple); font-weight: bold; }
        .nav-icon { font-size: 20px; margin-bottom: 4px; }

        /* æœç´¢æ¡† */
        .search-box { margin-bottom: 15px; }
    </style>
</head>
<body>

<header>
    <h2 style="margin:0">Sekai Collection</h2>
</header>

<div class="container">
    
    <div id="page-add" class="page active">
        <div class="card" style="text-align: center;">
            <h3>ç¶“è²»ç‡ƒç‡’çµ±è¨ˆ</h3>
            <div class="stat-val">NT$ <span id="totalDisplay">0</span></div>
            <p style="font-size:12px; color:#999;">ç›®å‰å…±æœ‰ <span id="countDisplay">0</span> ä»¶å‘¨é‚Š</p>
        </div>

        <div class="card">
            <h3>ğŸ“ æ–°å¢ç´€éŒ„</h3>
            <form id="merchForm">
                <div class="form-grid">
                    <div>
                        <label>ä½œå“åˆ†é¡</label>
                        <select id="workName">
                            <option value="ä¸–ç•Œè¨ˆç•« (PJSK)">ä¸–ç•Œè¨ˆç•« (PJSK)</option>
                            <option value="VOCALOID / åˆéŸ³æœªä¾†">VOCALOID / åˆéŸ³æœªä¾†</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    <div>
                        <label>ç¾è²¨ç‹€æ…‹</label>
                        <select id="status">
                            <option value="ç¾è²¨">ç¾è²¨ (å·²æ‹¿åˆ°)</option>
                            <option value="éç¾è²¨">éç¾è²¨ (é è³¼/ä»£è³¼ä¸­)</option>
                        </select>
                    </div>
                </div>
                <label>å‘¨é‚Šåç¨±</label>
                <input type="text" id="itemName" placeholder="ä¾‹ï¼šå®µå´å¥ é–ƒå¾½" required>
                
                <div class="form-grid">
                    <div>
                        <label>å‘¨é‚Šé¡åˆ¥</label>
                        <select id="itemType">
                            <option value="è¥Ÿç« ">è¥Ÿç« /å¾½ç« </option>
                            <option value="è‰²ç´™">è‰²ç´™</option>
                            <option value="æ‹ç«‹å¾—">æ‹ç«‹å¾—/å°å¡</option>
                            <option value="ç«‹ç‰Œ">ç«‹ç‰Œ</option>
                            <option value="å…¬ä»”">å…¬ä»”/è¶´è¶´</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    <div>
                        <label>åƒ¹æ ¼ (NTD)</label>
                        <input type="number" id="price" placeholder="0" required>
                    </div>
                </div>

                <label>ä¸Šå‚³åœ–ç‰‡</label>
                <input type="file" id="imageFile" accept="image/*">

                <label>å‚™è¨»/è³¼è²·ä¾†æº</label>
                <textarea id="note" rows="2"></textarea>

                <button type="submit" class="btn-add">ç¢ºèªå­˜æª”</button>
            </form>
        </div>
    </div>

    <div id="page-gallery" class="page">
        <div class="search-box">
            <input type="text" id="searchReady" placeholder="ğŸ” æœå°‹ç¾è²¨æ”¶è—..." oninput="renderLists()">
        </div>
        <h3 style="color:var(--miku-green)">âœ… å·²å…¥æ‰‹çš„å¯¶è²</h3>
        <div class="gallery" id="readyList"></div>
    </div>

    <div id="page-pending" class="page">
        <div class="search-box">
            <input type="text" id="searchWait" placeholder="ğŸ” æœå°‹å¾…æ”¶æ¸…å–®..." oninput="renderLists()">
        </div>
        <h3 style="color:#f39c12">â³ é‹é€/é è³¼ä¸­</h3>
        <div class="gallery" id="waitList"></div>
    </div>

</div>

<nav class="nav-bar">
    <button class="nav-item active" onclick="showPage('page-add', this)">
        <span class="nav-icon">ğŸ“Š</span>
        <span>ç¸½è¦½/æ–°å¢</span>
    </button>
    <button class="nav-item" onclick="showPage('page-gallery', this)">
        <span class="nav-icon">âœ¨</span>
        <span>æ”¶è— (ç¾è²¨)</span>
    </button>
    <button class="nav-item" onclick="showPage('page-pending', this)">
        <span class="nav-icon">ğŸ›’</span>
        <span>å¾…æ”¶ (éç¾)</span>
    </button>
</nav>

<script>
    let merchList = JSON.parse(localStorage.getItem('miku_sekai_v4')) || [];

    // åˆ†é åˆ‡æ›åŠŸèƒ½
    function showPage(pageId, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        window.scrollTo(0, 0);
    }

    // æ¸²æŸ“æ¸…å–®
    function renderLists() {
        const readyContainer = document.getElementById('readyList');
        const waitContainer = document.getElementById('waitList');
        const searchReady = document.getElementById('searchReady').value.toLowerCase();
        const searchWait = document.getElementById('searchWait').value.toLowerCase();
        
        readyContainer.innerHTML = '';
        waitContainer.innerHTML = '';

        let total = 0;
        
        merchList.forEach((item, index) => {
            total += Number(item.price);
            const isMatch = item.name.toLowerCase().includes(item.status === 'ç¾è²¨' ? searchReady : searchWait);
            if (!isMatch) return;

            const card = document.createElement('div');
            card.className = 'item-card';
            const statusClass = item.status === 'ç¾è²¨' ? 'bg-ready' : 'bg-wait';
            
            card.innerHTML = `
                <span class="status-badge ${statusClass}">${item.status}</span>
                <img src="${item.img || 'https://via.placeholder.com/200?text=Wait+Photo'}" class="item-img">
                <div class="item-info">
                    <h4>${item.name}</h4>
                    <div class="price">$${Number(item.price).toLocaleString()}</div>
                    <div style="font-size:10px; color:#999; margin-top:5px;">${item.type} | ${item.work}</div>
                    <button onclick="deleteItem(${index})" style="background:none; border:none; color:#ff4757; font-size:10px; padding:0; margin-top:5px; cursor:pointer;">[åˆªé™¤]</button>
                </div>
            `;

            if (item.status === 'ç¾è²¨') {
                readyContainer.appendChild(card);
            } else {
                waitContainer.appendChild(card);
            }
        });

        document.getElementById('totalDisplay').innerText = total.toLocaleString();
        document.getElementById('countDisplay').innerText = merchList.length;
    }

    // è¡¨å–®æäº¤
    document.getElementById('merchForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const file = document.getElementById('imageFile').files[0];
        
        const saveData = (imgBase64) => {
            const newItem = {
                work: document.getElementById('workName').value,
                status: document.getElementById('status').value,
                name: document.getElementById('itemName').value,
                type: document.getElementById('itemType').value,
                price: document.getElementById('price').value,
                note: document.getElementById('note').value,
                img: imgBase64
            };
            merchList.unshift(newItem);
            localStorage.setItem('miku_sekai_v4', JSON.stringify(merchList));
            this.reset();
            alert('ç´€éŒ„æˆåŠŸï¼');
            renderLists();
        };

        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => saveData(reader.result);
            reader.readAsDataURL(file);
        } else {
            saveData(null);
        }
    });

    function deleteItem(index) {
        if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ')) {
            merchList.splice(index, 1);
            localStorage.setItem('miku_sekai_v4', JSON.stringify(merchList));
            renderLists();
        }
    }

    renderLists();
</script>
</body>
</html>
