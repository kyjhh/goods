<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sekai Storage Pro+</title>
    <style>
        :root { 
            --miku-green: #00E5D1; --sekai-purple: #747dff; --deep-purple: #4834d4;
            --glass: rgba(255, 255, 255, 0.95); --ready-color: #2ecc71; --wait-color: #f0932b;
        }
        body { font-family: 'PingFang TC', sans-serif; background: #f0f2f5; margin: 0; padding-bottom: 90px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; padding: 15px; }

        /* Header */
        header { background: linear-gradient(135deg, var(--miku-green), var(--sekai-purple)); padding: 25px; color: white; text-align: center; border-radius: 0 0 25px 25px; }
        
        /* åˆ†é é‚è¼¯ */
        .page { display: none; }
        .page.active { display: block; }

        /* é€šç”¨å¡ç‰‡ */
        .card { background: var(--glass); padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .stat-val { font-size: 32px; font-weight: bold; color: var(--deep-purple); }

        /* ç¯©é¸æ¨™ç±¤ (ç¾è²¨é å°ˆç”¨) */
        .filter-group { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; margin-bottom: 15px; white-space: nowrap; -webkit-overflow-scrolling: touch; }
        .filter-btn { background: #eee; border: none; padding: 6px 15px; border-radius: 20px; font-size: 13px; cursor: pointer; }
        .filter-btn.active { background: var(--sekai-purple); color: white; }

        /* è¡¨å–®æ¨£å¼ */
        label { display: block; font-size: 12px; font-weight: bold; margin: 12px 0 5px; color: #555; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 14px; }
        .btn-submit { background: var(--deep-purple); color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; margin-top: 20px; font-weight: bold; cursor: pointer; }

        /* åˆ—è¡¨æ¨£å¼ */
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .item-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; }
        .item-img { width: 100%; height: 160px; object-fit: cover; background: #eee; }
        .item-info { padding: 10px; position: relative; }
        .arrival-box { position: absolute; top: 10px; right: 10px; width: 22px; height: 22px; cursor: pointer; }

        /* åº•éƒ¨å°èˆª */
        .nav-bar { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: white; display: flex; justify-content: space-around; padding: 12px; border-radius: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); z-index: 1000; }
        .nav-item { border: none; background: none; color: #aaa; font-size: 11px; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--deep-purple); font-weight: bold; }
    </style>
</head>
<body>

<header><h2>SEKAI STORAGE</h2></header>

<div class="container">
    
    <div id="page-add" class="page active">
        <div class="card" style="text-align:center">
            <div class="stat-val">NT$ <span id="totalDisplay">0</span></div>
            <p style="font-size:12px; color:#888">ç¸½ç¶“è²»ç‡ƒç‡’ç´€éŒ„</p>
        </div>

        <div class="card">
            <h3 style="margin-top:0">â• æ–°å¢å‘¨é‚Š</h3>
            <form id="merchForm">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
                    <div>
                        <label>ä½œå“åˆ†é¡</label>
                        <select id="workName">
                            <option value="ä¸–ç•Œè¨ˆç•«">ä¸–ç•Œè¨ˆç•«</option>
                            <option value="VOCALOID">VOCALOID</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    <div>
                        <label>ç‹€æ…‹</label>
                        <select id="status" onchange="toggleMonthInput()">
                            <option value="ç¾è²¨">ç¾è²¨</option>
                            <option value="éç¾è²¨">éç¾è²¨</option>
                        </select>
                    </div>
                </div>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
                    <div>
                        <label>è§’è‰² (å¯è‡ªå¡«)</label>
                        <input type="text" id="roleName" list="roleOptions" placeholder="è§’è‰²å">
                    </div>
                    <div id="monthGroup" style="display:none">
                        <label>é è¨ˆåˆ°è²¨æœˆä»½</label>
                        <input type="month" id="arrivalMonth">
                    </div>
                </div>

                <label>å‘¨é‚Šåç¨±</label>
                <input type="text" id="itemName" placeholder="ä¾‹ï¼šé–ƒå¾½ã€ç«‹ç‰Œ" required>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
                    <div>
                        <label>å‘¨é‚Šé¡å‹</label>
                        <select id="itemType">
                            <option value="è¥Ÿç« ">è¥Ÿç« </option>
                            <option value="è‰²ç´™">è‰²ç´™</option>
                            <option value="ç«‹ç‰Œ">ç«‹ç‰Œ</option>
                            <option value="ç´™é¡">ç´™é¡</option>
                            <option value="å…¬ä»”">å…¬ä»”/è¶´è¶´</option>
                        </select>
                    </div>
                    <div>
                        <label>åƒ¹æ ¼ (NT$)</label>
                        <input type="number" id="price" required>
                    </div>
                </div>

                <label>è³¼è²·ä¾†æº</label>
                <input type="text" id="source" list="sourceOptions" placeholder="ä¾†æº">
                
                <label>ä¸Šå‚³ç…§ç‰‡</label>
                <input type="file" id="imageFile" accept="image/*">

                <button type="submit" class="btn-submit">å­˜å…¥è³‡æ–™åº« âœ¨</button>
            </form>
        </div>
    </div>

    <div id="page-gallery" class="page">
        <div class="filter-group" id="readyFilters">
            <button class="filter-btn active" onclick="setFilter('all')">å…¨éƒ¨</button>
            <button class="filter-btn" onclick="setFilter('work')">ä½œå“åˆ†é¡</button>
            <button class="filter-btn" onclick="setFilter('role')">è§’è‰²åˆ†é¡</button>
            <button class="filter-btn" onclick="setFilter('type')">å‘¨é‚Šé¡å‹</button>
        </div>
        <div id="subFilters" class="filter-group" style="display:none"></div>
        <div class="gallery" id="readyList"></div>
    </div>

    <div id="page-pending" class="page">
        <h3 style="color:var(--wait-color)">â³ å¾…æ”¶æ¸…å–® (å‹¾é¸å°æ–¹æ ¼ä»£è¡¨åˆ°è²¨)</h3>
        <div class="gallery" id="waitList"></div>
    </div>

</div>

<nav class="nav-bar">
    <button class="nav-item active" onclick="showPage('page-add', this)"><span>ğŸ“Š</span><span>ç®¡ç†</span></button>
    <button class="nav-item" onclick="showPage('page-gallery', this)"><span>âœ¨</span><span>ç¾è²¨</span></button>
    <button class="nav-item" onclick="showPage('page-pending', this)"><span>ğŸ“¦</span><span>éç¾</span></button>
</nav>

<datalist id="roleOptions"><option value="åˆéŸ³æœªä¾†"><option value="æ›‰å±±ç‘å¸Œ"><option value="å®µå´å¥"></datalist>
<datalist id="sourceOptions"><option value="Mercari"><option value="å®‰åˆ©ç¾ç‰¹"><option value="ä»£è³¼"></datalist>

<script>
    let merchList = JSON.parse(localStorage.getItem('sekai_v6')) || [];
    let currentFilterMode = 'all';
    let currentSubFilter = '';

    function showPage(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderLists();
    }

    function toggleMonthInput() {
        document.getElementById('monthGroup').style.display = document.getElementById('status').value === 'éç¾è²¨' ? 'block' : 'none';
    }

    function setFilter(mode) {
        currentFilterMode = mode;
        currentSubFilter = '';
        const subFilterEl = document.getElementById('subFilters');
        
        if (mode === 'all') {
            subFilterEl.style.display = 'none';
        } else {
            subFilterEl.style.display = 'flex';
            const keys = [...new Set(merchList.filter(i => i.status === 'ç¾è²¨').map(i => i[mode === 'work' ? 'work' : mode === 'role' ? 'role' : 'type']))];
            subFilterEl.innerHTML = keys.map(k => `<button class="filter-btn" onclick="currentSubFilter='${k}';renderLists()">${k}</button>`).join('');
        }
        renderLists();
    }

    function renderLists() {
        const readyContainer = document.getElementById('readyList');
        const waitContainer = document.getElementById('waitList');
        readyContainer.innerHTML = ''; waitContainer.innerHTML = '';
        let total = 0;

        merchList.forEach((item, index) => {
            total += Number(item.price);
            
            // æ§‹å»ºå¡ç‰‡ HTML
            const cardHTML = `
                <div class="item-card">
                    <img src="${item.img || 'https://via.placeholder.com/200?text=Wait'}" class="item-img">
                    <div class="item-info">
                        ${item.status === 'éç¾è²¨' ? `<input type="checkbox" class="arrival-box" title="å‹¾é¸ä»£è¡¨åˆ°è²¨" onclick="moveToReady(${index})">` : ''}
                        <div style="font-size:10px; color:var(--sekai-purple)">${item.role}</div>
                        <h4 style="margin:5px 0; font-size:13px">${item.name}</h4>
                        <div style="font-size:11px; color:#888">${item.status === 'éç¾è²¨' ? 'ğŸ“… '+item.month : item.type}</div>
                        <div style="color:red; font-weight:bold; font-size:14px">$${Number(item.price).toLocaleString()}</div>
                        <button onclick="deleteItem(${index})" style="background:none; border:none; color:#ccc; font-size:9px; padding:0">åˆªé™¤</button>
                    </div>
                </div>`;

            if (item.status === 'ç¾è²¨') {
                // ç¾è²¨éæ¿¾é‚è¼¯
                let match = true;
                if (currentFilterMode === 'work' && currentSubFilter && item.work !== currentSubFilter) match = false;
                if (currentFilterMode === 'role' && currentSubFilter && item.role !== currentSubFilter) match = false;
                if (currentFilterMode === 'type' && currentSubFilter && item.type !== currentSubFilter) match = false;
                if (match) readyContainer.insertAdjacentHTML('beforeend', cardHTML);
            } else {
                waitContainer.insertAdjacentHTML('beforeend', cardHTML);
            }
        });
        document.getElementById('totalDisplay').innerText = total.toLocaleString();
    }

    function moveToReady(index) {
        merchList[index].status = 'ç¾è²¨';
        localStorage.setItem('sekai_v6', JSON.stringify(merchList));
        renderLists();
    }

    document.getElementById('merchForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const file = document.getElementById('imageFile').files[0];
        const save = (img) => {
            merchList.unshift({
                work: document.getElementById('workName').value,
                role: document.getElementById('roleName').value || 'æœªåˆ†é¡',
                status: document.getElementById('status').value,
                month: document.getElementById('arrivalMonth').value || 'æœªå®š',
                name: document.getElementById('itemName').value,
                type: document.getElementById('itemType').value,
                price: document.getElementById('price').value,
                img: img
            });
            localStorage.setItem('sekai_v6', JSON.stringify(merchList));
            this.reset(); toggleMonthInput(); renderLists();
            alert('å·²æˆåŠŸå…¥åº«ï¼');
        };
        if (file) { const r = new FileReader(); r.onloadend = () => save(r.result); r.readAsDataURL(file); }
        else save(null);
    });

    function deleteItem(i) { if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) { merchList.splice(i,1); localStorage.setItem('sekai_v6', JSON.stringify(merchList)); renderLists(); }}
    
    renderLists();
</script>
</body>
</html>
